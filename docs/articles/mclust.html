<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploring model-based clustering with condvis2 • condvis2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Exploring model-based clustering with condvis2">
<meta property="og:description" content="condvis2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">condvis2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Keras.html">Exploring keras models with condvis2</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction to condvis2</a>
    </li>
    <li>
      <a href="../articles/mclust.html">Exploring model-based clustering with condvis2</a>
    </li>
    <li>
      <a href="../articles/mlr.html">mlr fits and condvis2</a>
    </li>
    <li>
      <a href="../articles/parsnip.html">parsnip fits and condvis2</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cbhurley/condvis2/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mclust_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Exploring model-based clustering with condvis2</h1>
                        <h4 class="author">Catherine B. Hurley</h4>
            
            <h4 class="date">2021-04-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cbhurley/condvis2/blob/master/vignettes/mclust.Rmd"><code>vignettes/mclust.Rmd</code></a></small>
      <div class="hidden name"><code>mclust.Rmd</code></div>

    </div>

    
    
<p><code>mclust</code> is a R package that offers - model-based clustering: <code>Mclust</code> - classification ( discriminant analysis): <code>MclustDA</code> - density estimation <code>densityMclust</code> all based on mixtures of Normals.</p>
<p><code>condvis2</code> offers an interface to all of these.</p>
<p>We start with</p>
<div id="classification-mclustda" class="section level2">
<h2 class="hasAnchor">
<a href="#classification-mclustda" class="anchor"></a>Classification: MclustDA</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cbhurley/condvis2">condvis2</a></span><span class="op">)</span>
<span class="co">#&gt; Registered S3 method overwritten by 'seriation':</span>
<span class="co">#&gt;   method         from </span>
<span class="co">#&gt;   reorder.hclust gclus</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mclust-org.github.io/mclust/">mclust</a></span><span class="op">)</span>
<span class="co">#&gt; Package 'mclust' version 5.4.7</span>
<span class="co">#&gt; Type 'citation("mclust")' for citing this R package in publications.</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">)</span>
<span class="va">bankDA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/MclustDA.html">MclustDA</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">banknote</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>This fits an XXX=ellipsoidal multivariate normal for the genuine notes and EVE2 = ellipsoidal, equal volume and equal shape with two components for counterfeits.</p>
<p>Condvis uses a generic <code>CVpredict</code> to provide a uniform interface to <code>predict</code> methods. We will use it to find the number of misclassifications:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">$</span><span class="va">Status</span>, <span class="fu"><a href="../reference/CVpredict.html">CVpredict</a></span><span class="op">(</span><span class="va">bankDA</span>, <span class="va">banknote</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;              </span>
<span class="co">#&gt;               counterfeit genuine</span>
<span class="co">#&gt;   counterfeit         100       0</span>
<span class="co">#&gt;   genuine               0     100</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Top"</span>, <span class="st">"Diagonal"</span><span class="op">)</span>
<span class="va">cvars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">svars</span><span class="op">)</span>
<span class="fu"><a href="../reference/condvis.html">condvis</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">banknote</span>, model <span class="op">=</span> <span class="va">bankDA</span>, 
        response<span class="op">=</span><span class="st">"Status"</span>, sectionvars<span class="op">=</span><span class="va">svars</span>,conditionvars<span class="op">=</span><span class="va">cvars</span>, 
        pointColor<span class="op">=</span><span class="st">"Status"</span>, showsim<span class="op">=</span><span class="cn">TRUE</span>
        <span class="op">)</span></code></pre></div>
<p>The <code>showsim=TRUE</code> setting means that the condition plots will mark points considered sufficiently near the section with a dark outline. This is the default setting only when <span class="math inline">\(n &lt;= 150\)</span>. In the condition plots, the green points are the genuine ones, pink are counterfeit.</p>
<p>Here is a views of the result:</p>
<p><img src="vignettefigs/mclustda1.png" width="100%" style="display: block; margin: auto;"> There is one point that appears to be mis-classified (though it is not). However, as it’s size is small it is not very close to the selected section.</p>
<p>Selecting <code>Show probs</code>: we see there is some uncertainty about the classification on the classification boundaries.</p>
<p>A different, simpler fit is got using</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bankDAe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/MclustDA.html">MclustDA</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">banknote</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, modelType<span class="op">=</span><span class="st">"EDDA"</span>,verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>This uses an EVE1 for each class, and there is one mis-classification, at case 70.</p>
<p>We can use condvis to compare the two fits:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/condvis.html">condvis</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">banknote</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bankDA<span class="op">=</span><span class="va">bankDA</span>, bankDAe<span class="op">=</span><span class="va">bankDAe</span><span class="op">)</span>, 
        response<span class="op">=</span><span class="st">"Status"</span>, sectionvars<span class="op">=</span><span class="va">svars</span>,conditionvars<span class="op">=</span><span class="va">cvars</span>, 
        pointColor<span class="op">=</span><span class="st">"Status"</span>, showsim<span class="op">=</span><span class="cn">T</span>
        <span class="op">)</span></code></pre></div>
<p>If you go to Tour, <code>Diff fits</code>, you can move through views where the conditioning points are those where the fits disagree. In this case there is only one such point. Here <code>Show probs</code> is selected so there is some uncertainty visible at the classification boundaries.</p>
<p>The screenshot shows that in this view. <img src="vignettefigs/mclustda6.png" width="100%" style="display: block; margin: auto;"></p>
<p>The mis-classified point is a genuine note (green) which is just inside the region classified as counterfeit by EDDA. Here also the Similarity threshold is made small so only the point on the section is visible in the section plot. From the condition plots it is evident this note has a low Diagonal size, like the counterfeits.</p>
</div>
<div id="density-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#density-estimation" class="anchor"></a>Density estimation</h2>
<p>First calculate a density estimate of two variables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">)</span>
<span class="va">dens2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/densityMclust.html">densityMclust</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Diagonal"</span>,<span class="st">"Left"</span><span class="op">)</span><span class="op">]</span>,verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dens2</span><span class="op">)</span>
<span class="co">#&gt; ------------------------------------------------------- </span>
<span class="co">#&gt; Density estimation via Gaussian finite mixture modeling </span>
<span class="co">#&gt; ------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Mclust EEI (diagonal, equal volume and shape) model with 4 components: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  log-likelihood   n df       BIC       ICL</span>
<span class="co">#&gt;       -289.6722 200 13 -648.2225 -664.0955</span></code></pre></div>
<p>We can visualise the density as a surface or contour plot. Alternatively, we can use condvis to show the conditional density, fixing one of the variables.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/condvis.html">condvis</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">banknote</span>, model <span class="op">=</span> <span class="va">dens2</span>, response<span class="op">=</span><span class="cn">NULL</span>,
        sectionvars<span class="op">=</span><span class="st">"Diagonal"</span>,conditionvars<span class="op">=</span><span class="st">"Left"</span>,
        density<span class="op">=</span><span class="cn">T</span>, showdata<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>The density of Diagonal varies with the Left value. Click on left to check this. <img src="vignettefigs/left1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Estimating the density of three variables:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dens3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/densityMclust.html">densityMclust</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Right"</span>, <span class="st">"Bottom"</span>, <span class="st">"Diagonal"</span><span class="op">)</span><span class="op">]</span>,verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dens3</span><span class="op">)</span>
<span class="co">#&gt; ------------------------------------------------------- </span>
<span class="co">#&gt; Density estimation via Gaussian finite mixture modeling </span>
<span class="co">#&gt; ------------------------------------------------------- </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Mclust EEI (diagonal, equal volume and shape) model with 4 components: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  log-likelihood   n df       BIC       ICL</span>
<span class="co">#&gt;        -544.611 200 18 -1184.592 -1197.047</span></code></pre></div>
<p>By way of comparison, here is the kernel density estimate to compare with mclust:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.mvstat.net/mvksa/">ks</a></span><span class="op">)</span>
<span class="va">kdens3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ks/man/kde.html">kde</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Right"</span>, <span class="st">"Bottom"</span>, <span class="st">"Diagonal"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/condvis.html">condvis</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">banknote</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mclust<span class="op">=</span><span class="va">dens3</span>, kde<span class="op">=</span><span class="va">kdens3</span><span class="op">)</span>, response<span class="op">=</span><span class="cn">NULL</span>,
        sectionvars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Bottom"</span>, <span class="st">"Diagonal"</span><span class="op">)</span>,conditionvars<span class="op">=</span><span class="st">"Right"</span>,
        density<span class="op">=</span><span class="cn">T</span>, showdata<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>As you vary the level of Right, both densities look quite similar.</p>
<p><img src="vignettefigs/dens3Right2.png" width="100%" style="display: block; margin: auto;"><!-- https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5096736/ --></p>
<p>Click on “Show 3d surface” to get a wireframe plot.</p>
</div>
<div id="clustering-example" class="section level1">
<h1 class="hasAnchor">
<a href="#clustering-example" class="anchor"></a>Clustering example</h1>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bankC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mclust-org.github.io/mclust/reference/Mclust.html">Mclust</a></span><span class="op">(</span><span class="va">banknote</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,verbose<span class="op">=</span><span class="cn">F</span><span class="op">)</span> <span class="co"># picks 3 clusters</span>
<span class="va">banknote1</span> <span class="op">&lt;-</span> <span class="va">banknote</span>
<span class="va">banknote1</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="../reference/CVpredict.html">CVpredict</a></span><span class="op">(</span><span class="va">bankC</span>, <span class="va">banknote</span><span class="op">)</span><span class="op">)</span>

<span class="va">svars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Top"</span>, <span class="st">"Diagonal"</span><span class="op">)</span>
<span class="va">cvars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Left"</span>,    <span class="st">"Right"</span> ,  <span class="st">"Bottom"</span><span class="op">)</span>
<span class="fu"><a href="../reference/condvis.html">condvis</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">banknote1</span>, model <span class="op">=</span> <span class="va">bankC</span>, 
        response<span class="op">=</span><span class="st">"cluster"</span>, sectionvars<span class="op">=</span><span class="va">svars</span>,conditionvars<span class="op">=</span><span class="va">cvars</span>, 
        pointColor<span class="op">=</span><span class="st">"Status"</span>, showsim<span class="op">=</span><span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Catherine Hurley, Mark OConnell, Katarina Domijan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
